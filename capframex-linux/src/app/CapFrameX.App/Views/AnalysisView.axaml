<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:CapFrameX.App.ViewModels"
             xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
             x:Class="CapFrameX.App.Views.AnalysisView"
             x:DataType="vm:AnalysisViewModel">

    <Grid ColumnDefinitions="280,*" Margin="15">
        <!-- Left Panel - Session List -->
        <Border Grid.Column="0" Background="#1E2A3A" CornerRadius="10" Padding="15" Margin="0 0 10 0" BorderBrush="#2A3F55" BorderThickness="1">
            <DockPanel>
                <StackPanel DockPanel.Dock="Top" Spacing="10" Margin="0 0 0 10">
                    <TextBlock Text="Sessions" FontSize="16" FontWeight="SemiBold" />
                    <Button Content="Refresh" Command="{Binding RefreshCommand}" HorizontalAlignment="Stretch" />
                </StackPanel>

                <Button DockPanel.Dock="Bottom" Content="Delete Session"
                        Command="{Binding DeleteSessionCommand}"
                        IsEnabled="{Binding SelectedSession, Converter={x:Static ObjectConverters.IsNotNull}}"
                        HorizontalAlignment="Stretch"
                        Margin="0 10 0 0" />

                <ListBox ItemsSource="{Binding Sessions}"
                         SelectedItem="{Binding SelectedSession}"
                         Background="Transparent">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="5">
                                <TextBlock Text="{Binding GameName}" FontWeight="SemiBold" TextTrimming="CharacterEllipsis" />
                                <TextBlock Text="{Binding StartTime, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}"
                                           FontSize="11" Opacity="0.7" />
                                <StackPanel Orientation="Horizontal" Spacing="10">
                                    <TextBlock Text="{Binding AverageFps, StringFormat='Avg: {0:F0} FPS'}" FontSize="11" />
                                    <TextBlock Text="{Binding FrameCount, StringFormat='{}{0} frames'}" FontSize="11" Opacity="0.5" />
                                </StackPanel>
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </DockPanel>
        </Border>

        <!-- Right Panel - Analysis -->
        <Grid Grid.Column="1" RowDefinitions="Auto,Auto,*,*">
            <!-- Session Info Bar -->
            <Border Grid.Row="0" Background="#1E2A3A" CornerRadius="10" Padding="15 10" Margin="0 0 0 10" BorderBrush="#2A3F55" BorderThickness="1"
                    IsVisible="{Binding SelectedSession, Converter={x:Static ObjectConverters.IsNotNull}}">
                <StackPanel Orientation="Horizontal" Spacing="25">
                    <!-- Game Name -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="Game" FontSize="11" Opacity="0.6" VerticalAlignment="Center" />
                        <TextBlock Text="{Binding GameName}" FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- Resolution -->
                    <StackPanel Orientation="Horizontal" Spacing="8"
                                IsVisible="{Binding Resolution, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        <TextBlock Text="Resolution" FontSize="11" Opacity="0.6" VerticalAlignment="Center" />
                        <TextBlock Text="{Binding Resolution}" FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- GPU -->
                    <StackPanel Orientation="Horizontal" Spacing="8"
                                IsVisible="{Binding GpuName, Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        <TextBlock Text="GPU" FontSize="11" Opacity="0.6" VerticalAlignment="Center" />
                        <TextBlock Text="{Binding GpuName}" FontSize="14" FontWeight="SemiBold"
                                   MaxWidth="180" TextTrimming="CharacterEllipsis"
                                   ToolTip.Tip="{Binding GpuName}" VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- Timing Mode -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="Timing" FontSize="11" Opacity="0.6" VerticalAlignment="Center" />
                        <TextBlock Text="{Binding TimingMode}" FontSize="14" FontWeight="SemiBold"
                                   Foreground="{Binding TimingModeColor}"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Statistics -->
            <WrapPanel Grid.Row="1" Margin="0 0 0 10">
                <Border Background="#1E2A3A" CornerRadius="10" Padding="15 10" Margin="0 0 10 10" MinWidth="100" BorderBrush="#2A3F55" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Avg FPS" FontSize="11" Foreground="#4AA3DF" />
                        <TextBlock Text="{Binding AverageFps, StringFormat='{}{0:F1}'}" FontSize="22" FontWeight="Bold" />
                    </StackPanel>
                </Border>

                <Border Background="#1E2A3A" CornerRadius="10" Padding="15 10" Margin="0 0 10 10" MinWidth="100" BorderBrush="#2A3F55" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="1% Low" FontSize="11" Foreground="#4AA3DF" />
                        <TextBlock Text="{Binding P1Fps, StringFormat='{}{0:F1}'}" FontSize="22" FontWeight="Bold" />
                    </StackPanel>
                </Border>

                <Border Background="#1E2A3A" CornerRadius="10" Padding="15 10" Margin="0 0 10 10" MinWidth="100" BorderBrush="#2A3F55" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="0.1% Low" FontSize="11" Foreground="#4AA3DF" />
                        <TextBlock Text="{Binding P01Fps, StringFormat='{}{0:F1}'}" FontSize="22" FontWeight="Bold" />
                    </StackPanel>
                </Border>

                <Border Background="#1E2A3A" CornerRadius="10" Padding="15 10" Margin="0 0 10 10" MinWidth="100" BorderBrush="#2A3F55" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Avg Frametime" FontSize="11" Foreground="#4AA3DF" />
                        <TextBlock Text="{Binding AverageFrametime, StringFormat='{}{0:F2} ms'}" FontSize="22" FontWeight="Bold" />
                    </StackPanel>
                </Border>

                <Border Background="#1E2A3A" CornerRadius="10" Padding="15 10" Margin="0 0 10 10" MinWidth="100" BorderBrush="#2A3F55" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Std Dev" FontSize="11" Foreground="#4AA3DF" />
                        <TextBlock Text="{Binding StdDev, StringFormat='{}{0:F2} ms'}" FontSize="22" FontWeight="Bold" />
                    </StackPanel>
                </Border>

                <Border Background="#1E2A3A" CornerRadius="10" Padding="15 10" Margin="0 0 10 10" MinWidth="100" BorderBrush="#2A3F55" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Frames" FontSize="11" Foreground="#4AA3DF" />
                        <TextBlock Text="{Binding FrameCount}" FontSize="22" FontWeight="Bold" />
                    </StackPanel>
                </Border>

                <Border Background="#1E2A3A" CornerRadius="10" Padding="15 10" Margin="0 0 10 10" MinWidth="100" BorderBrush="#2A3F55" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Duration" FontSize="11" Foreground="#4AA3DF" />
                        <TextBlock Text="{Binding Duration}" FontSize="22" FontWeight="Bold" />
                    </StackPanel>
                </Border>
            </WrapPanel>

            <!-- Frametime Chart -->
            <Border Grid.Row="2" Background="#1E2A3A" CornerRadius="10" Padding="15" Margin="0 0 0 10" BorderBrush="#2A3F55" BorderThickness="1">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="Frametime" FontWeight="SemiBold" Foreground="#4AA3DF" Margin="0 0 0 10" />
                    <lvc:CartesianChart Series="{Binding FrametimeSeries}"
                                        XAxes="{Binding FrametimeXAxes}"
                                        YAxes="{Binding FrametimeYAxes}"
                                        ZoomMode="X" />
                </DockPanel>
            </Border>

            <!-- FPS Chart and Histogram -->
            <Grid Grid.Row="3" ColumnDefinitions="*,*">
                <Border Grid.Column="0" Background="#1E2A3A" CornerRadius="10" Padding="15" Margin="0 0 5 0" BorderBrush="#2A3F55" BorderThickness="1">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top" Text="FPS" FontWeight="SemiBold" Foreground="#4AA3DF" Margin="0 0 0 10" />
                        <lvc:CartesianChart Series="{Binding FpsSeries}"
                                            XAxes="{Binding FpsXAxes}"
                                            YAxes="{Binding FpsYAxes}"
                                            ZoomMode="X" />
                    </DockPanel>
                </Border>

                <Border Grid.Column="1" Background="#1E2A3A" CornerRadius="10" Padding="15" Margin="5 0 0 0" BorderBrush="#2A3F55" BorderThickness="1">
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Top" Text="Distribution" FontWeight="SemiBold" Foreground="#4AA3DF" Margin="0 0 0 10" />
                        <lvc:CartesianChart Series="{Binding HistogramSeries}" />
                    </DockPanel>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</UserControl>
