<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="using:CapFrameX.App.ViewModels"
             xmlns:lvc="using:LiveChartsCore.SkiaSharpView.Avalonia"
             x:Class="CapFrameX.App.Views.CaptureView"
             x:DataType="vm:CaptureViewModel">

    <Grid ColumnDefinitions="300,*" Margin="15">
        <!-- Left Panel - Game Selection and System Info -->
        <Grid Grid.Column="0" RowDefinitions="*,Auto" Margin="0 0 10 0">
            <!-- Game Selection -->
            <Border Grid.Row="0" Background="#1E2A3A" CornerRadius="10" Padding="15" BorderBrush="#2A3F55" BorderThickness="1">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="Detected Games" FontSize="16" FontWeight="SemiBold" Margin="0 0 0 10" />

                    <StackPanel DockPanel.Dock="Bottom" Spacing="10" Margin="0 10 0 0">
                        <Button Content="{Binding CaptureButtonText}"
                            Command="{Binding ToggleCaptureCommand}"
                            IsEnabled="{Binding CanCapture}"
                            HorizontalAlignment="Stretch"
                            HorizontalContentAlignment="Center"
                            Padding="0 12"
                            FontSize="14"
                            Classes.capturing="{Binding IsCapturing}">
                        <Button.Styles>
                            <Style Selector="Button.capturing">
                                <Setter Property="Background" Value="#E74C3C" />
                                <Setter Property="Foreground" Value="White" />
                            </Style>
                            <Style Selector="Button:not(.capturing)">
                                <Setter Property="Background" Value="#4AA3DF" />
                                <Setter Property="Foreground" Value="White" />
                            </Style>
                        </Button.Styles>
                    </Button>
                </StackPanel>

                <ListBox ItemsSource="{Binding DetectedGames}"
                         SelectedItem="{Binding SelectedGame}"
                         Background="Transparent">
                    <ListBox.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="Add to Ignore List"
                                      Command="{Binding AddToIgnoreListCommand}"
                                      CommandParameter="{Binding SelectedGame}" />
                        </ContextMenu>
                    </ListBox.ContextMenu>
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Margin="5">
                                <TextBlock Text="{Binding Name}" FontWeight="SemiBold" />
                                <TextBlock Text="{Binding Resolution}"
                                           FontSize="11" Opacity="0.8" Foreground="#4AA3DF"
                                           IsVisible="{Binding Resolution, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                                <TextBlock Text="{Binding GpuName}"
                                           FontSize="11" Opacity="0.7"
                                           IsVisible="{Binding GpuName, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                                <TextBlock Text="{Binding Launcher, StringFormat='via {0}'}"
                                           FontSize="11" Opacity="0.6"
                                           IsVisible="{Binding Launcher, Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />
                                <TextBlock Text="{Binding Pid, StringFormat='PID: {0}'}"
                                           FontSize="11" Opacity="0.4" />
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </DockPanel>
        </Border>

            <!-- System Info Panel -->
            <Border Grid.Row="1" Background="#1E2A3A" CornerRadius="10" Padding="15" Margin="0 10 0 0" BorderBrush="#2A3F55" BorderThickness="1">
                <StackPanel Spacing="8">
                    <TextBlock Text="System Info" FontSize="14" FontWeight="SemiBold" Foreground="#4AA3DF" Margin="0 0 0 5" />

                    <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto" Margin="0">
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="CPU" FontSize="11" Opacity="0.6" Margin="0 0 10 4" />
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding SystemInfo.CpuName}" FontSize="11" TextTrimming="CharacterEllipsis" ToolTip.Tip="{Binding SystemInfo.CpuName}" />

                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Cores" FontSize="11" Opacity="0.6" Margin="0 0 10 4" />
                        <TextBlock Grid.Row="1" Grid.Column="1" FontSize="11">
                            <TextBlock.Text>
                                <MultiBinding StringFormat="{}{0}C / {1}T">
                                    <Binding Path="SystemInfo.CpuCores" />
                                    <Binding Path="SystemInfo.CpuThreads" />
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>

                        <TextBlock Grid.Row="2" Grid.Column="0" Text="RAM" FontSize="11" Opacity="0.6" Margin="0 0 10 4" />
                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding SystemInfo.TotalRam}" FontSize="11" />

                        <TextBlock Grid.Row="3" Grid.Column="0" Text="GPU" FontSize="11" Opacity="0.6" Margin="0 0 10 4" />
                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding SystemInfo.GpuName}" FontSize="11" TextTrimming="CharacterEllipsis" ToolTip.Tip="{Binding SystemInfo.GpuName}" />

                        <TextBlock Grid.Row="4" Grid.Column="0" Text="iGPU" FontSize="11" Opacity="0.6" Margin="0 0 10 4"
                                   IsVisible="{Binding SystemInfo.HasIgpu}" />
                        <TextBlock Grid.Row="4" Grid.Column="1" Text="{Binding SystemInfo.IgpuName}" FontSize="11" TextTrimming="CharacterEllipsis"
                                   ToolTip.Tip="{Binding SystemInfo.IgpuName}" IsVisible="{Binding SystemInfo.HasIgpu}" />

                        <TextBlock Grid.Row="5" Grid.Column="0" Text="Board" FontSize="11" Opacity="0.6" Margin="0 0 10 0" />
                        <TextBlock Grid.Row="5" Grid.Column="1" Text="{Binding SystemInfo.Motherboard}" FontSize="11" TextTrimming="CharacterEllipsis" ToolTip.Tip="{Binding SystemInfo.Motherboard}" />
                    </Grid>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Right Panel - Live Stats and Chart -->
        <Grid Grid.Column="1" RowDefinitions="Auto,Auto,Auto,*">
            <!-- Game Info Bar -->
            <Border Grid.Row="0" Background="#1E2A3A" CornerRadius="10" Padding="15 12" Margin="0 0 0 10" BorderBrush="#2A3F55" BorderThickness="1">
                <StackPanel Orientation="Horizontal" Spacing="30">
                    <!-- Game Name (larger, prominent) -->
                    <TextBlock Text="{Binding GameInfoName}" FontSize="18" FontWeight="SemiBold"
                               Foreground="{Binding GameInfoNameColor}" MaxWidth="350" TextTrimming="CharacterEllipsis"
                               ToolTip.Tip="{Binding GameInfoName}" VerticalAlignment="Center" />

                    <!-- Resolution -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="Resolution" FontSize="11" Opacity="0.6" VerticalAlignment="Center" />
                        <TextBlock Text="{Binding GameInfoResolution}" FontSize="14" FontWeight="SemiBold"
                                   Foreground="#4AA3DF" VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- GPU -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="GPU" FontSize="11" Opacity="0.6" VerticalAlignment="Center" />
                        <TextBlock Text="{Binding GameInfoGpu}" FontSize="14" FontWeight="SemiBold"
                                   MaxWidth="280" TextTrimming="CharacterEllipsis"
                                   ToolTip.Tip="{Binding GameInfoGpu}" VerticalAlignment="Center" />
                    </StackPanel>

                    <!-- Launcher -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <TextBlock Text="Launcher" FontSize="11" Opacity="0.6" VerticalAlignment="Center" />
                        <TextBlock Text="{Binding GameInfoLauncher}" FontSize="14" FontWeight="SemiBold"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                </StackPanel>
            </Border>

            <!-- Statistics Cards -->
            <WrapPanel Grid.Row="1" Margin="0 0 0 10">
                <Border Background="#1E2A3A" CornerRadius="10" Padding="20 15" Margin="0 0 10 10" MinWidth="120" BorderBrush="#2A3F55" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="FPS" FontSize="12" Foreground="#4AA3DF" />
                        <TextBlock Text="{Binding CurrentFps, StringFormat='{}{0:F1}'}" FontSize="28" FontWeight="Bold" />
                    </StackPanel>
                </Border>

                <Border Background="#1E2A3A" CornerRadius="10" Padding="20 15" Margin="0 0 10 10" MinWidth="120" BorderBrush="#2A3F55" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="1% Low" FontSize="12" Foreground="#4AA3DF" />
                        <TextBlock Text="{Binding P1LowFps, StringFormat='{}{0:F1}'}" FontSize="28" FontWeight="Bold" />
                    </StackPanel>
                </Border>

                <Border Background="#1E2A3A" CornerRadius="10" Padding="20 15" Margin="0 0 10 10" MinWidth="120" BorderBrush="#2A3F55" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="0.1% Low" FontSize="12" Foreground="#4AA3DF" />
                        <TextBlock Text="{Binding P01LowFps, StringFormat='{}{0:F1}'}" FontSize="28" FontWeight="Bold" />
                    </StackPanel>
                </Border>

                <Border Background="#1E2A3A" CornerRadius="10" Padding="20 15" Margin="0 0 10 10" MinWidth="120" BorderBrush="#2A3F55" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="Avg Frametime" FontSize="12" Foreground="#4AA3DF" />
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding AverageFrametime, StringFormat='{}{0:F2}'}" FontSize="28" FontWeight="Bold" />
                            <TextBlock Text="ms" FontSize="14" VerticalAlignment="Bottom" Margin="4 0 0 5" Opacity="0.7" />
                        </StackPanel>
                    </StackPanel>
                </Border>
            </WrapPanel>

            <!-- Hardware Metrics -->
            <WrapPanel Grid.Row="2" Margin="0 0 0 10">
                <!-- GPU Metrics -->
                <Border Background="#1E2A3A" CornerRadius="10" Padding="15 12" Margin="0 0 10 0" BorderBrush="#2A3F55" BorderThickness="1">
                    <StackPanel Orientation="Horizontal" Spacing="20">
                        <TextBlock Text="GPU" FontSize="12" FontWeight="SemiBold" Foreground="#4AA3DF" VerticalAlignment="Center" Width="30" />
                        <StackPanel>
                            <TextBlock Text="Temp" FontSize="10" Opacity="0.6" />
                            <TextBlock Text="{Binding GpuTemperature}" FontSize="14" FontWeight="SemiBold" FontFamily="monospace" />
                        </StackPanel>
                        <StackPanel>
                            <TextBlock Text="Power" FontSize="10" Opacity="0.6" />
                            <TextBlock Text="{Binding GpuPower}" FontSize="14" FontWeight="SemiBold" FontFamily="monospace" />
                        </StackPanel>
                        <StackPanel>
                            <TextBlock Text="Usage" FontSize="10" Opacity="0.6" />
                            <TextBlock Text="{Binding GpuUsage}" FontSize="14" FontWeight="SemiBold" FontFamily="monospace" />
                        </StackPanel>
                        <StackPanel>
                            <TextBlock Text="Core" FontSize="10" Opacity="0.6" />
                            <TextBlock Text="{Binding GpuCoreClock}" FontSize="14" FontWeight="SemiBold" FontFamily="monospace" />
                        </StackPanel>
                        <StackPanel>
                            <TextBlock Text="Mem" FontSize="10" Opacity="0.6" />
                            <TextBlock Text="{Binding GpuMemClock}" FontSize="14" FontWeight="SemiBold" FontFamily="monospace" />
                        </StackPanel>
                        <StackPanel>
                            <TextBlock Text="VRAM" FontSize="10" Opacity="0.6" />
                            <TextBlock Text="{Binding GpuVram}" FontSize="14" FontWeight="SemiBold" FontFamily="monospace" />
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- CPU Metrics -->
                <Border Background="#1E2A3A" CornerRadius="10" Padding="15 12" Margin="0 0 10 0" BorderBrush="#2A3F55" BorderThickness="1">
                    <StackPanel Orientation="Horizontal" Spacing="20">
                        <TextBlock Text="CPU" FontSize="12" FontWeight="SemiBold" Foreground="#4AA3DF" VerticalAlignment="Center" Width="30" />
                        <StackPanel>
                            <TextBlock Text="Load" FontSize="10" Opacity="0.6" />
                            <TextBlock Text="{Binding CpuUsage}" FontSize="14" FontWeight="SemiBold" FontFamily="monospace" />
                        </StackPanel>
                        <StackPanel>
                            <TextBlock Text="Temp" FontSize="10" Opacity="0.6" />
                            <TextBlock Text="{Binding CpuTemperature}" FontSize="14" FontWeight="SemiBold" FontFamily="monospace" />
                        </StackPanel>
                        <StackPanel>
                            <TextBlock Text="Freq" FontSize="10" Opacity="0.6" />
                            <TextBlock Text="{Binding CpuFrequency}" FontSize="14" FontWeight="SemiBold" FontFamily="monospace" />
                        </StackPanel>
                    </StackPanel>
                </Border>
            </WrapPanel>

            <!-- Live Chart -->
            <Border Grid.Row="3" Background="#1E2A3A" CornerRadius="10" Padding="15" BorderBrush="#2A3F55" BorderThickness="1">
                <DockPanel>
                    <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0 0 0 10">
                        <TextBlock Text="Live Chart" FontSize="14" FontWeight="SemiBold" Foreground="#4AA3DF" VerticalAlignment="Center" />
                        <ToggleSwitch IsChecked="{Binding LiveChartEnabled}" Margin="15 0 0 0" OnContent="" OffContent="" />
                    </StackPanel>
                    <lvc:CartesianChart Series="{Binding FrametimeSeries}"
                                        XAxes="{Binding XAxes}"
                                        YAxes="{Binding YAxes}"
                                        TooltipPosition="Hidden"
                                        ZoomMode="X" />
                </DockPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
